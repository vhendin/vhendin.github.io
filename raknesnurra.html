<!doctype html>
<html lang="sv">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <title>Räknesnurra för lån</title>
        <meta
            name="description"
            content="En enkel räknesnurra för att beräkna amorteringsplan, ränta och betalningar för ett lån."
        />
        <link rel="stylesheet" href="resources/styles/raknesnurra.css" />
        <link rel="icon" href="favicon.ico" />
        <!-- (Removed inline theme <style>; theme variables now fully managed in CSS file) -->
        <!-- Chart.js utan SRI (integrity) pga tidigare mismatch -> fallback script om första laddningen misslyckas -->
        <script src="
        https://cdn.jsdelivr.net/npm/chart.js@4.5.0/dist/chart.umd.min.js
        "></script>
        <script defer src="resources/scripts/raknesnurra.js"></script>
    </head>
    <body>
        <header class="page-header">
            <h1>Räknesnurra – Lån & Amortering</h1>
            <p class="tagline">
                Beräkna betalningar, ränta och skuldsaldo över tid.
            </p>
        </header>

        <main id="app">
            <section class="panel inputs">
                <h2>Indata</h2>
                <form id="loan-form" novalidate>
                    <div class="field">
                        <label for="projectCost">Projektkostnad (kr)</label>
                        <input
                            type="number"
                            id="projectCost"
                            name="projectCost"
                            min="1"
                            step="1000"
                            required
                            placeholder="t.ex. 7000000"
                        />
                        <small class="hint">Total kostnad för projektet.</small>
                    </div>
                    <div class="field">
                        <label for="downPayment">Handpenning (kr)</label>
                        <input
                            type="number"
                            id="downPayment"
                            name="downPayment"
                            min="0"
                            step="1000"
                            value="0"
                            required
                        />
                        <small class="hint"
                            >Dras av från projektkostnaden för att få
                            lånebeloppet.</small
                        >
                    </div>
                    <div class="field">
                        <label for="interestRate">Årsränta (%)</label>
                        <input
                            type="number"
                            id="interestRate"
                            name="interestRate"
                            min="0"
                            max="100"
                            step="0.01"
                            required
                            placeholder="t.ex. 3"
                        />
                        <small class="hint"
                            >Fast nominell ränta under hela perioden.</small
                        >
                    </div>
                    <fieldset class="field group" id="calcModeGroup">
                        <legend>Beräkningsläge</legend>
                        <div class="field inline">
                            <label>
                                <input
                                    type="radio"
                                    name="calcMode"
                                    value="byTerm"
                                    id="calcModeByTerm"
                                    checked
                                />
                                Ange löptid (år)
                            </label>
                        </div>
                        <div class="field inline">
                            <label>
                                <input
                                    type="radio"
                                    name="calcMode"
                                    value="byPrincipalPerPeriod"
                                    id="calcModeByPrincipal"
                                />
                                Ange amortering per period
                            </label>
                        </div>
                        <div class="field inline">
                            <label>
                                <input
                                    type="radio"
                                    name="calcMode"
                                    value="annuity"
                                    id="calcModeAnnuity"
                                />
                                Annuitet (konstant betalning)
                            </label>
                        </div>
                    </fieldset>
                    <div class="field mode-byTerm" id="termYearsField">
                        <label for="termYears">Löptid (år)</label>
                        <input
                            type="number"
                            id="termYears"
                            name="termYears"
                            min="1"
                            max="50"
                            step="1"
                            required
                        />
                        <small class="hint">Max 50 år.</small>
                    </div>
                    <div
                        class="field mode-byPrincipalPerPeriod hidden"
                        id="amortPerPeriodField"
                    >
                        <label for="amortPerPeriod"
                            >Amortering per period</label
                        >
                        <input
                            type="number"
                            id="amortPerPeriod"
                            name="amortPerPeriod"
                            min="1"
                            step="1"
                        />
                        <small class="hint"
                            >Belopp i kronor per vald period (t.ex. 50000).
                            Sista perioden justeras automatiskt.</small
                        >
                    </div>
                    <div class="field">
                        <label for="frequency">Betalfrekvens</label>
                        <select id="frequency" name="frequency">
                            <option value="monthly">
                                Månadsvis (12 ggr/år)
                            </option>
                            <option value="quarterly">
                                Kvartalsvis (4 ggr/år)
                            </option>
                            <option value="semiannual">
                                Halvår (2 ggr/år)
                            </option>
                            <option value="annual">Årsvis (1 gång/år)</option>
                        </select>
                    </div>
                    <div class="field">
                        <label>
                            <input
                                type="checkbox"
                                id="displayModeTsek"
                                name="displayModeTsek"
                            />
                            Visa belopp i tusen kronor (tsek)
                        </label>
                    </div>
                    <fieldset class="field group">
                        <legend>Betalare</legend>
                        <div class="field inline">
                            <label for="payerCount">Antal betalare</label>
                            <input
                                type="number"
                                id="payerCount"
                                name="payerCount"
                                min="1"
                                max="250"
                                step="1"
                                value="1"
                            />
                        </div>
                        <small class="hint"
                            >Fördelning: Alltid lika delar mellan
                            deltagare.</small
                        >
                    </fieldset>
                    <fieldset class="field group" id="extraPaymentsGroup">
                        <legend>Extra amorteringar (valfritt)</legend>
                        <div class="hint" style="font-size: 0.7rem">
                            Lägg till engångs- eller återkommande extra
                            amorteringar. De förkortar löptiden.
                        </div>
                        <div id="extraPaymentsList" class="extra-list">
                            <!-- Rader för extra amorteringar renderas dynamiskt -->
                        </div>
                        <button
                            type="button"
                            class="secondary small"
                            id="addExtraPaymentBtn"
                        >
                            Lägg till extra amortering
                        </button>
                    </fieldset>
                    <div class="actions">
                        <button type="button" id="calculateBtn" class="primary">
                            Beräkna
                        </button>
                        <button type="reset" class="secondary" id="resetBtn">
                            Rensa
                        </button>
                    </div>
                    <div
                        id="validationMessages"
                        class="messages"
                        aria-live="assertive"
                    ></div>
                </form>
            </section>
            <section class="panel summary">
                <h2>Sammanfattning</h2>
                <div class="result-grid" id="summaryResults">
                    <div class="result">
                        <span class="label">Lånebelopp</span>
                        <span class="value" id="loanAmountDisplay">–</span>
                    </div>
                    <div class="result">
                        <span class="label">Antal betalperioder</span>
                        <span class="value" id="periodCountDisplay">–</span>
                    </div>
                    <div class="result">
                        <span class="label">Amortering per period</span>
                        <span class="value" id="principalPerPeriodDisplay"
                            >–</span
                        >
                    </div>
                    <div class="result">
                        <span class="label">Första periodens ränta</span>
                        <span class="value" id="firstInterestDisplay">–</span>
                    </div>
                    <div class="result">
                        <span class="label"
                            >Första periodens totalbetalning</span
                        >
                        <span class="value" id="firstPaymentDisplay">–</span>
                    </div>
                    <div class="result">
                        <span class="label">Total ränta (hela perioden)</span>
                        <span class="value" id="totalInterestDisplay">–</span>
                    </div>
                    <div class="result">
                        <span class="label">Total återbetalning</span>
                        <span class="value" id="totalPaidDisplay">–</span>
                    </div>
                    <div class="result calcmode-derived">
                        <span class="label">Beräknade perioder</span>
                        <span class="value" id="derivedPeriodCountDisplay"
                            >–</span
                        >
                    </div>
                    <div class="result calcmode-derived">
                        <span class="label">Beräknad löptid (år)</span>
                        <span class="value" id="derivedYearsDisplay">–</span>
                    </div>
                    <div class="result calcmode-derived">
                        <span class="label">Sista periodens amortering</span>
                        <span class="value" id="lastPrincipalDisplay">–</span>
                    </div>
                    <div class="result extra-results">
                        <span class="label">Årskostnad (total)</span>
                        <span class="value" id="yearlyTotalDisplay">–</span>
                    </div>
                    <div class="result extra-results">
                        <span class="label">Årskostnad per deltagare</span>
                        <span class="value" id="yearlyPerParticipantDisplay"
                            >–</span
                        >
                    </div>
                    <div class="result extra-results">
                        <span class="label"
                            >Kostnad per deltagare per period</span
                        >
                        <span class="value" id="periodPerParticipantDisplay"
                            >–</span
                        >
                    </div>
                    <div class="result extra-results" id="interestSavedCard">
                        <span class="label">Ränta sparad</span>
                        <span class="value" id="interestSavedDisplay">–</span>
                    </div>
                </div>
                <!-- Per-betalare detaljer borttagna: lika fördelning alltid -->
            </section>
            <section class="panel annual-overview">
                <h2>Årsöversikt</h2>
                <div class="table-controls">
                    <p class="hint">
                        Summerade värden per år. Klicka på en rad för att visa
                        underliggande perioder (månad / kvartal) och kostnad per
                        deltagare.
                    </p>
                </div>
                <div class="table-wrapper" id="annualWrapper">
                    <table id="annualTable">
                        <thead>
                            <tr>
                                <th>År</th>
                                <th>Total betalning</th>
                                <th>Ränta</th>
                                <th>Amortering</th>
                                <th>Restskuld (slut)</th>
                                <th>Per deltagare (år)</th>
                                <th>Detalj</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Fylls dynamiskt -->
                        </tbody>
                    </table>
                </div>
                <div
                    class="annual-details hidden"
                    id="annualDetails"
                    aria-live="polite"
                >
                    <!-- Dynamiskt expanderat innehåll: periodtabell för valt år (period, total, ränta, amortering, per deltagare) -->
                </div>
            </section>
            <section class="panel charts">
                <h2>Grafer</h2>
                <div class="charts-wrapper">
                    <div class="chart-block">
                        <h3>Skuld över tid</h3>
                        <canvas id="balanceChart" height="180"></canvas>
                    </div>
                    <div class="chart-block">
                        <h3>Ränta vs Amortering per period</h3>
                        <canvas id="paymentChart" height="180"></canvas>
                    </div>
                </div>
            </section>
            <section class="panel schedule">
                <h2>Amorteringsplan</h2>
                <div class="table-controls">
                    <button
                        type="button"
                        id="toggleScheduleBtn"
                        class="secondary small"
                    >
                        Visa/Dölj tabell
                    </button>
                    <button
                        type="button"
                        id="exportCsvBtn"
                        class="secondary small"
                    >
                        Exportera CSV
                    </button>
                </div>
                <div class="table-wrapper collapsed" id="scheduleWrapper">
                    <table id="scheduleTable">
                        <thead>
                            <tr>
                                <th>Period</th>
                                <th>Saldo start</th>
                                <th>Amortering</th>
                                <th>Extra amortering</th>
                                <th>Ränta</th>
                                <th>Betalning</th>
                                <th>Saldo slut</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Fylls dynamiskt -->
                        </tbody>
                    </table>
                </div>
            </section>
            <section class="panel notes">
                <h2>Noteringar</h2>
                <ul class="notes-list">
                    <li>
                        Stöder lägen: Rak amortering (lika stort
                        amorteringsbelopp), Fast amortering per period samt
                        Annuitet (konstant totalbetalning där räntedelen minskar
                        och amorteringsdelen ökar över tiden).
                    </li>
                    <li>
                        Räntan beräknas periodvis som kvarvarande skuld *
                        (årsränta / antal perioder per år).
                    </li>
                    <li>
                        Belopp kan visas i antingen kronor eller tusen kronor
                        (tsek) beroende på val i indata.
                    </li>
                    <li>
                        Ingen hänsyn tas till skatteeffekter eller inflation.
                    </li>
                </ul>
            </section>
        </main>
        <footer class="page-footer">
            <small
                >&copy; <span id="year"></span> Räknesnurra. Alla rättigheter
                förbehållna.</small
            >
        </footer>
        <template id="payerRowTemplate">
            <div class="payer-row">
                <label></label>
                <input
                    type="number"
                    min="0"
                    max="100"
                    step="0.01"
                    class="payer-percentage"
                />
                <span class="unit">%</span>
            </div>
        </template>
        <template id="payerSummaryTemplate">
            <div class="payer-result">
                <span class="payer-label"></span>
                <span class="payer-value"></span>
            </div>
        </template>
        <script>
            // Minimal script to set current year if JS file hasn't yet varit implementerad
            document.getElementById("year").textContent =
                new Date().getFullYear();
        </script>
    </body>
</html>
